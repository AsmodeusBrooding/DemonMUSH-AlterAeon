<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Friday, March 15, 2019, 11:13 PM -->
<!-- MuClient version 5.06-pre -->

<!-- Plugin "DemonMUSH_Auction" generated by Plugin Wizard -->

<!--
Comments about this plugin will go here.
-->

<muclient>
<plugin
   name="DemonMUSH_Auction"
   author="Soth"
   id="c2d74453d9e1ec38be0633f2"
   language="Lua"
   purpose="Send bidding info to the 'demonauc' channel and track auction earnings/spendings"
   date_written="2019-03-15 23:10:57"
   requires="4.92"
   save_state = "y"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->
-- Please wait until the auction closes on the current item.
<triggers>
  <trigger
   enabled="y"
   match="Current bid is * gold coins for '*'."
   send_to="12"
   sequence="100"
  >
  <send>itemString = "%2"
		</send></trigger>
  <trigger
   enabled="y"
   match="(auction) Now accepting bids for '*', minimum bid is * gold coins."
   send_to="12"
   sequence="100"
  >
  <send>itemString = "%1"
		if itemInsult ~= "null" and itemInsult ~= nil  then
			itemStartBid = %2
			if playerTitle ~= "default" then
				Send("demonauc "..playerTitle.." Started the bidding on item '%1' at '%2' gold.")
			else
				Send("demonauc Started the bidding on item '%1' at '%2' gold.")
			end
			itemInsult = "null"
		end
		</send></trigger>
  <trigger
   enabled="y"
   match="(auction) Starting bid on '*' at * gold."
   omit_from_output="y"
   send_to="12"
   sequence="100"
  >
  <send>itemString = "%1"
		if itemInsult ~= "null" and itemInsult ~= nil then
			itemStartBid = %2
			if playerTitle ~= "default" then
				Send("demonauc "..playerTitle.." Started the bidding on item '%1' at '%2' gold.")
			else
				Send("demonauc Started the bidding on item '%1' at '%2' gold.")
			end
			itemInsult = "null"
		end
		</send></trigger>
  <trigger
   enabled="y"
   match="* gold coins put up in escrow."
   send_to="12"
   sequence="100"
  >
  <send>if itemBidAmt ~= "null" and itemBidAmt ~= nil then
			if playerTitle ~= "default" then
				Send("demonauc "..playerTitle.." Placed a bid of '"..itemBidAmt.."' gold on item "..itemString..".")
			else
				Send("demonauc Placed a bid of '"..itemBidAmt.."' gold on item "..itemString..".")
			end
			itemBidAmt = "null"
		end</send></trigger>
  <trigger
   enabled="n"
   match="* tells you, '* *'"
   omit_from_output="n"
   send_to="14"
   keep_evaluating="y"
   sequence="100"
  >
  <send>checkName = "%1" 
		if checkName == "Soth" or checkName == "Carver" or checkName == "A terrible winged Demon" then
			if "%2" == "badge" then
				playerTitle = "%3"
				SetVariable("playerTitleSave", playerTitle)
				print("")
				ColourNote("ghostwhite", "indigo", "You have been awarded the "..playerTitle.." badge for the demonauc channel!")
				SaveState()
			end
		end</send></trigger>
  <trigger
   enabled="y"
   match="cuadFight string: *"
   omit_from_output="y"
   send_to="12"
   sequence="100"
  >
  <send>opponent = "%1"</send></trigger>
</triggers>


<!--  Aliases  -->

<aliases>
  <alias
   match="auction *"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>itemInsult = "%1"
		Send("auction %1")
		DoAfterSpecial(2, "itemInsult = 'null'", sendto.script)</send></alias>
  <alias
   match="bid *"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>itemBidAmt = "%1"
		Send("bid %1")
		DoAfterSpecial(2, "itemBidAmt = 'null'", sendto.script)</send></alias>
  <alias
   match="challenge *"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>opponent = "%1"
		Send("fin "..opponent.." |prefix cuad|grep Fight")
		DoAfterSpecial(2, "if opponent ~= nil then Send('demonauc Challenges '..opponent..' to a bidding war!') end", sendto.script)</send></alias>
</aliases>
  
<!--  Script  -->
<script>
<![CDATA[
----------------------------------------------------------------------------------------
-- Functions
----------------------------------------------------------------------------------------
	function OnPluginInstall()
		ColourNote ("white", "indigo", "DemonMUSH_Auction has been installed.")
	end
	if GetVariable("playerTitleSave") ~= nil then
		playerTitle = GetVariable("playerTitleSave")
	else
		playerTitle = "default"
	end
----------------------------------------------------------------------------------------
-- Global Variables
----------------------------------------------------------------------------------------
	itemInsult = "null"
	itemString = "default"
	
----------------------------------------------------------------------------------------
-- Tables
----------------------------------------------------------------------------------------	
	demonaucData = {}
	
]]>
</script>
</muclient>